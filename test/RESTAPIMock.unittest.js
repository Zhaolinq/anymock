"use strict";
const {
    URL,
    URLSearchParams
} = require('url');
const removeProtocal = require('../lib/removeProtocal')
const createRes = require('../lib/createRes')
const RESTAPIMock = require("../lib/RESTAPIMock");
const URLO = new URL('http://i.vip.iqiyi.com/client/store/pc/checkout.action?platform=b6c13e26323c537d&pid=a0226bd958843452&fs=&fsSign=&fc=a03a512fefb9eaf7&fv=&qc005=ee3dc1362b22680c6bc6af43931650a8&vipType=1&aid=&P00001=50AIWkGubnxCHgI96u5jpLV7P2AqF2ZzY1JEbtrAjthkx0oxcQWNqm2grZwm3q5BZAVAf0&callback=jsonp_05611606862977503');
const myURL = removeProtocal(URLO.href);
const searchParams = URLO.searchParams;
const callbackName = searchParams.get('callback');
const mockMap = {
    "body": {
        "code": "A00000",
        "data": {
            "msg": "成功",
            "code": "A00000",
            "data": {
                "vipTypeName": "钻石VIP会员",
                "autoRenewSuits": [{
                    "amount": 1,
                    "autorenewTip": "",
                    "originalPrice": 4980,
                    "payAutoRenew": "3",
                    "description": "连续包月",
                    "pid": "adb3376b039b970b",
                    "recommend": 1,
                    "sort": 1,
                    "privilege": 0,
                    "type": 1,
                    "payTypeOptions": [{
                        "supportType": "",
                        "payAutoRenew": 0,
                        "icon": "http://pic3.qiyipic.com/common/20180507/CARDPAY.png",
                        "description": "",
                        "recommend": 0,
                        "privilege": 0,
                        "needPayFee": 4980,
                        "payType": 95,
                        "balance": "",
                        "autoRenew": 0,
                        "iconUrl": "",
                        "id": 1427,
                        "lang": "zh_CN",
                        "amount": 1,
                        "autoRenewTip": "",
                        "sort": 1,
                        "dealType": "",
                        "supportPurchase": false,
                        "enableAUtoRenew": false,
                        "monthly": 1,
                        "name": "银行卡支付",
                        "moneyUnit": "CNY",
                        "payChannel": 8,
                        "region": "cn",
                        "subPromotion": "",
                        "promotion": ""
                    }, {
                        "supportType": "ALI,WECHAT,BAIDU",
                        "payAutoRenew": 0,
                        "icon": "http://pic3.qiyipic.com/common/20180507/CARDPAY.png",
                        "description": "",
                        "recommend": 1,
                        "privilege": 0,
                        "needPayFee": 4980,
                        "payType": 378,
                        "balance": "",
                        "autoRenew": 0,
                        "iconUrl": "",
                        "id": 1018,
                        "lang": "zh_CN",
                        "amount": 1,
                        "autoRenewTip": "",
                        "sort": 1,
                        "dealType": "",
                        "supportPurchase": false,
                        "enableAUtoRenew": false,
                        "monthly": 1,
                        "name": "扫码支付",
                        "moneyUnit": "CNY",
                        "payChannel": 8,
                        "region": "cn",
                        "subPromotion": "",
                        "promotion": ""
                    }],
                    "actCode": "",
                    "marketingPositionIcon": null,
                    "needPayFee": 4980,
                    "price": 4980,
                    "id": 14653,
                    "marketingPositionUrl": null,
                    "supportCoupon": 1,
                    "giftMonths": 0,
                    "promotion": null,
                    "marketingPositionWords": null
                }, {
                    "amount": 3,
                    "autorenewTip": "",
                    "originalPrice": 14800,
                    "payAutoRenew": "3",
                    "description": "连续包季",
                    "pid": "adb3376b039b970b",
                    "recommend": 0,
                    "sort": 2,
                    "privilege": 0,
                    "type": 1,
                    "payTypeOptions": [{
                        "supportType": "",
                        "payAutoRenew": 0,
                        "icon": "http://pic3.qiyipic.com/common/20180507/CARDPAY.png",
                        "description": "",
                        "recommend": 0,
                        "privilege": 0,
                        "needPayFee": 14800,
                        "payType": 95,
                        "balance": "",
                        "autoRenew": 0,
                        "iconUrl": "",
                        "id": 1429,
                        "lang": "zh_CN",
                        "amount": 3,
                        "autoRenewTip": "",
                        "sort": 1,
                        "dealType": "",
                        "supportPurchase": false,
                        "enableAUtoRenew": false,
                        "monthly": 1,
                        "name": "银行卡支付",
                        "moneyUnit": "CNY",
                        "payChannel": 8,
                        "region": "cn",
                        "subPromotion": "",
                        "promotion": ""
                    }, {
                        "supportType": "ALI,WECHAT",
                        "payAutoRenew": 0,
                        "icon": "http://pic3.qiyipic.com/common/20180507/CARDPAY.png",
                        "description": "",
                        "recommend": 1,
                        "privilege": 0,
                        "needPayFee": 14800,
                        "payType": 378,
                        "balance": "",
                        "autoRenew": 0,
                        "iconUrl": "",
                        "id": 1019,
                        "lang": "zh_CN",
                        "amount": 3,
                        "autoRenewTip": "",
                        "sort": 1,
                        "dealType": "",
                        "supportPurchase": false,
                        "enableAUtoRenew": false,
                        "monthly": 1,
                        "name": "扫码支付",
                        "moneyUnit": "CNY",
                        "payChannel": 8,
                        "region": "cn",
                        "subPromotion": "",
                        "promotion": ""
                    }],
                    "actCode": "",
                    "marketingPositionIcon": null,
                    "needPayFee": 14800,
                    "price": 14800,
                    "id": 14654,
                    "marketingPositionUrl": null,
                    "supportCoupon": 1,
                    "giftMonths": 0,
                    "promotion": null,
                    "marketingPositionWords": null
                }, {
                    "amount": 12,
                    "autorenewTip": "",
                    "originalPrice": 49800,
                    "payAutoRenew": "3",
                    "description": "连续包年",
                    "pid": "adb3376b039b970b",
                    "recommend": 0,
                    "sort": 3,
                    "privilege": 20000,
                    "type": 1,
                    "payTypeOptions": [{
                        "supportType": "ALI,WECHAT,BAIDU",
                        "payAutoRenew": 0,
                        "icon": "http://pic3.qiyipic.com/common/20180507/CARDPAY.png",
                        "description": "",
                        "recommend": 1,
                        "privilege": 20000,
                        "needPayFee": 29800,
                        "payType": 378,
                        "balance": "",
                        "autoRenew": 0,
                        "iconUrl": "",
                        "id": 1426,
                        "lang": "zh_CN",
                        "amount": 12,
                        "autoRenewTip": "",
                        "sort": 1,
                        "dealType": "",
                        "supportPurchase": false,
                        "enableAUtoRenew": false,
                        "monthly": 1,
                        "name": "扫码支付",
                        "moneyUnit": "CNY",
                        "payChannel": 8,
                        "region": "cn",
                        "subPromotion": "",
                        "promotion": ""
                    }, {
                        "supportType": "",
                        "payAutoRenew": 0,
                        "icon": "http://pic3.qiyipic.com/common/20180507/CARDPAY.png",
                        "description": "",
                        "recommend": 0,
                        "privilege": 20000,
                        "needPayFee": 29800,
                        "payType": 95,
                        "balance": "",
                        "autoRenew": 0,
                        "iconUrl": "",
                        "id": 1431,
                        "lang": "zh_CN",
                        "amount": 12,
                        "autoRenewTip": "",
                        "sort": 1,
                        "dealType": "",
                        "supportPurchase": false,
                        "enableAUtoRenew": false,
                        "monthly": 1,
                        "name": "银行卡支付",
                        "moneyUnit": "CNY",
                        "payChannel": 8,
                        "region": "cn",
                        "subPromotion": "",
                        "promotion": ""
                    }],
                    "actCode": "",
                    "marketingPositionIcon": null,
                    "needPayFee": 29800,
                    "price": 29800,
                    "id": 14656,
                    "marketingPositionUrl": null,
                    "supportCoupon": 0,
                    "giftMonths": 0,
                    "promotion": null,
                    "marketingPositionWords": null
                }],
                "userInfo": {
                    "vipSuperscript": "",
                    "type": "1",
                    "vipDeadline": "2019-01-30 17:07:42",
                    "isVipUser": true
                },
                "userAutoRenew": 1,
                "storeNodeLocations": {
                    "vipTypeCornerLocation": {
                        "icon": "http://www.iqiyipic.com/common/fix/vipcash/cash-icon-diamonds.png",
                        "text": "钻石VIP会员",
                        "url": ""
                    },
                    "tabActivityLocation": {
                        "icon": "",
                        "text": "适用于电视/电脑/手机/iPad",
                        "url": ""
                    }
                },
                "vipType": 4,
                "showAutoRenew": "2",
                "suits": [{
                    "amount": 1,
                    "autorenewTip": "",
                    "originalPrice": 49800,
                    "payAutoRenew": "0",
                    "description": "1个月",
                    "pid": "adb3376b039b970b",
                    "recommend": 0,
                    "sort": 1,
                    "privilege": 49799,
                    "type": 1,
                    "payTypeOptions": [{
                        "supportType": "",
                        "payAutoRenew": 0,
                        "icon": "http://pic3.qiyipic.com/common/20180507/CARDPAY.png",
                        "description": "",
                        "recommend": 0,
                        "privilege": 49799,
                        "needPayFee": 1,
                        "payType": 95,
                        "balance": "",
                        "autoRenew": 0,
                        "iconUrl": "",
                        "id": 1425,
                        "lang": "zh_CN",
                        "amount": 1,
                        "autoRenewTip": "",
                        "sort": 1,
                        "dealType": "",
                        "supportPurchase": false,
                        "enableAUtoRenew": false,
                        "monthly": 0,
                        "name": "银行卡支付",
                        "moneyUnit": "CNY",
                        "payChannel": 8,
                        "region": "cn",
                        "subPromotion": "",
                        "promotion": ""
                    }, {
                        "supportType": "ALI,WECHAT",
                        "payAutoRenew": 0,
                        "icon": "",
                        "description": "",
                        "recommend": 1,
                        "privilege": 49799,
                        "needPayFee": 1,
                        "payType": 378,
                        "balance": "",
                        "autoRenew": 0,
                        "iconUrl": "",
                        "id": 978,
                        "lang": "zh_CN",
                        "amount": 1,
                        "autoRenewTip": "",
                        "sort": 1,
                        "dealType": "",
                        "supportPurchase": false,
                        "enableAUtoRenew": false,
                        "monthly": 0,
                        "name": "扫码支付",
                        "moneyUnit": "CNY",
                        "payChannel": 0,
                        "region": "cn",
                        "subPromotion": "",
                        "promotion": ""
                    }],
                    "actCode": "",
                    "marketingPositionIcon": "",
                    "needPayFee": 1,
                    "price": 1,
                    "id": 15674,
                    "marketingPositionUrl": "",
                    "supportCoupon": 0,
                    "giftMonths": 0,
                    "promotion": "钻石月简体PCW",
                    "marketingPositionWords": ""
                }, {
                    "amount": 3,
                    "autorenewTip": "",
                    "originalPrice": 49800,
                    "payAutoRenew": "0",
                    "description": "3个月",
                    "pid": "adb3376b039b970b",
                    "recommend": 0,
                    "sort": 2,
                    "privilege": 49799,
                    "type": 1,
                    "payTypeOptions": [{
                        "supportType": "",
                        "payAutoRenew": 0,
                        "icon": "http://pic3.qiyipic.com/common/20180507/CARDPAY.png",
                        "description": "",
                        "recommend": 0,
                        "privilege": 49799,
                        "needPayFee": 1,
                        "payType": 95,
                        "balance": "",
                        "autoRenew": 0,
                        "iconUrl": "",
                        "id": 1428,
                        "lang": "zh_CN",
                        "amount": 3,
                        "autoRenewTip": "",
                        "sort": 1,
                        "dealType": "",
                        "supportPurchase": false,
                        "enableAUtoRenew": false,
                        "monthly": 0,
                        "name": "银行卡支付",
                        "moneyUnit": "CNY",
                        "payChannel": 8,
                        "region": "cn",
                        "subPromotion": "",
                        "promotion": ""
                    }, {
                        "supportType": "ALI,WECHAT,BAIDU",
                        "payAutoRenew": 0,
                        "icon": "http://pic3.qiyipic.com/common/20180507/CARDPAY.png",
                        "description": "",
                        "recommend": 1,
                        "privilege": 49799,
                        "needPayFee": 1,
                        "payType": 378,
                        "balance": "",
                        "autoRenew": 0,
                        "iconUrl": "",
                        "id": 1020,
                        "lang": "zh_CN",
                        "amount": 3,
                        "autoRenewTip": "",
                        "sort": 1,
                        "dealType": "",
                        "supportPurchase": false,
                        "enableAUtoRenew": false,
                        "monthly": 0,
                        "name": "扫码支付",
                        "moneyUnit": "CNY",
                        "payChannel": 8,
                        "region": "cn",
                        "subPromotion": "",
                        "promotion": ""
                    }],
                    "actCode": "",
                    "marketingPositionIcon": "",
                    "needPayFee": 1,
                    "price": 1,
                    "id": 15675,
                    "marketingPositionUrl": "",
                    "supportCoupon": 0,
                    "giftMonths": 0,
                    "promotion": "",
                    "marketingPositionWords": ""
                }, {
                    "amount": 12,
                    "autorenewTip": "",
                    "originalPrice": 49800,
                    "payAutoRenew": "0",
                    "description": "12个月",
                    "pid": "adb3376b039b970b",
                    "recommend": 1,
                    "sort": 3,
                    "privilege": 49799,
                    "type": 1,
                    "payTypeOptions": [{
                        "supportType": "",
                        "payAutoRenew": 0,
                        "icon": "http://pic3.qiyipic.com/common/20180507/CARDPAY.png",
                        "description": "",
                        "recommend": 0,
                        "privilege": 49799,
                        "needPayFee": 1,
                        "payType": 95,
                        "balance": "",
                        "autoRenew": 0,
                        "iconUrl": "",
                        "id": 1430,
                        "lang": "zh_CN",
                        "amount": 12,
                        "autoRenewTip": "",
                        "sort": 1,
                        "dealType": "",
                        "supportPurchase": false,
                        "enableAUtoRenew": false,
                        "monthly": 0,
                        "name": "银行卡支付",
                        "moneyUnit": "CNY",
                        "payChannel": 8,
                        "region": "cn",
                        "subPromotion": "",
                        "promotion": ""
                    }, {
                        "supportType": "ALI,WECHAT",
                        "payAutoRenew": 0,
                        "icon": "http://pic3.qiyipic.com/common/20180507/CARDPAY.png",
                        "description": "",
                        "recommend": 1,
                        "privilege": 49799,
                        "needPayFee": 1,
                        "payType": 378,
                        "balance": "",
                        "autoRenew": 0,
                        "iconUrl": "",
                        "id": 1021,
                        "lang": "zh_CN",
                        "amount": 12,
                        "autoRenewTip": "",
                        "sort": 1,
                        "dealType": "",
                        "supportPurchase": false,
                        "enableAUtoRenew": false,
                        "monthly": 0,
                        "name": "扫码支付",
                        "moneyUnit": "CNY",
                        "payChannel": 8,
                        "region": "cn",
                        "subPromotion": "",
                        "promotion": ""
                    }],
                    "actCode": "",
                    "marketingPositionIcon": null,
                    "needPayFee": 1,
                    "price": 1,
                    "id": 14657,
                    "marketingPositionUrl": null,
                    "supportCoupon": 0,
                    "giftMonths": 0,
                    "promotion": "",
                    "marketingPositionWords": null
                }]
            }
        }
    }
}

describe("RESTAPIMock", () => {
    it("matched", () => {
        expect(RESTAPIMock(myURL, searchParams, callbackName)).toEqual({
            match: true,
            response: createRes(callbackName, mockMap)
        });
    });
});